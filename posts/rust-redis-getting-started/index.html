<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Getting started with Rust and Redis - Foo Bar Baz</title>
  <meta name="description" content="Are you learning Rust and looking for ways to get some hands-on practice with concrete examples?">
  <meta name="author" content="Abhishek Gupta"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Foo Bar Baz",
    
    "url": "https:\/\/abhirockzz.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/abhirockzz.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/abhirockzz.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/abhirockzz.github.io\/posts\/rust-redis-getting-started\/",
          "name": "Getting started with rust and redis"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Abhishek Gupta"
  },
  "headline": "Getting started with Rust and Redis",
  "description" : "Are you learning Rust and looking for ways to get some hands-on practice with concrete examples?",
  "inLanguage" : "en",
  "wordCount":  1324 ,
  "datePublished" : "2021-01-20T00:00:00",
  "dateModified" : "2021-01-20T00:00:00",
  "image" : "https:\/\/abhirockzz.github.io\/icon.jpg",
  "keywords" : [ "Rust, Redis, Azure, NoSQL" ],
  "mainEntityOfPage" : "https:\/\/abhirockzz.github.io\/posts\/rust-redis-getting-started\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/abhirockzz.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/abhirockzz.github.io\/icon.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Getting started with Rust and Redis" />
<meta property="og:description" content="Are you learning Rust and looking for ways to get some hands-on practice with concrete examples?">
<meta property="og:image" content="https://abhirockzz.github.io/icon.jpg" />
<meta property="og:url" content="https://abhirockzz.github.io/posts/rust-redis-getting-started/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Foo Bar Baz" />

  <meta name="twitter:title" content="Getting started with Rust and Redis" />
  <meta name="twitter:description" content="Are you learning Rust and looking for ways to get some hands-on practice with concrete examples?">
  <meta name="twitter:image" content="https://abhirockzz.github.io/icon.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@abhi_tweeter" />
  <meta name="twitter:creator" content="@abhi_tweeter" />
  <link href='https://abhirockzz.github.io/icons/myicon.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.80.0" />
  <link rel="alternate" href="https://abhirockzz.github.io/index.xml" type="application/rss+xml" title="Foo Bar Baz"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://abhirockzz.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://abhirockzz.github.io/css/syntax.css" /><link rel="stylesheet" href="https://abhirockzz.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-54762029-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://abhirockzz.github.io/">Foo Bar Baz</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        
          
            <li>
              <a title="Books" href="/books">Books</a>
            </li>
          
        
          
            <li>
              <a title="Presentations" href="/presentations">Presentations</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Foo Bar Baz" href="https://abhirockzz.github.io/">
            <img class="avatar-img" src="https://abhirockzz.github.io/icon.jpg" alt="Foo Bar Baz" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Getting started with Rust and Redis</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Are you learning <a href="https://www.rust-lang.org/">Rust</a> and looking for ways to get some hands-on practice with concrete examples? A good approach might be to try and integrate Rust with external systems. Why not try to use it with <a href="https://redis.io/">Redis</a>? It is a powerful, versatile database but dead simple to get started with!</p>
<p>In this blog post, you will learn how to use the Rust programming language to interact with Redis using the <a href="https://github.com/mitsuhiko/redis-rs">redis-rs</a> client. We will walk through commonly used Redis data structures such as <a href="https://redis.io/topics/data-types-intro#redis-strings">String</a>, <a href="https://redis.io/topics/data-types-intro#redis-hashes">Hash</a>, <a href="https://redis.io/topics/data-types-intro#redis-lists">List</a> etc. The Redis client used in the sample code exposes both high and low-level APIs and you will see both these styles in action.</p>
<blockquote>
<p>Code is available on GitHub - <a href="https://github.com/abhirockzz/rust-redis-101">https://github.com/abhirockzz/rust-redis-101</a></p>
</blockquote>
<p>Redis is an in-memory data structure store which is often used as a database, cache, and message broker. It provides data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes, and streams.</p>
<p>In this blog post, I have included instructions for <a href="https://docs.microsoft.com/azure/azure-cache-for-redis/?WT.mc_id=data-12975-abhishgu">Azure Cache for Redis</a>, but the sample application should work with any Redis instance. Azure Cache for Redis offers both the Redis open-source and a <a href="https://docs.microsoft.com/azure/azure-cache-for-redis/quickstart-create-redis-enterprise?WT.mc_id=data-12975-abhishgu">commercial product from Redis Labs</a> as a managed service.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>You will need <a href="https://www.rust-lang.org/tools/install">Rust</a> (version 1.39 or above) installed on your computer. If you intend to use Azure Cache for Redis, simply <a href="https://azure.microsoft.com/free/">create a free Azure subscription</a>, and <a href="https://docs.microsoft.com/azure/azure-cache-for-redis/quickstart-create-redis?WT.mc_id=data-12975-abhishgu">setup an Azure Cache for Redis instance</a> using the Azure portal.</p>
<blockquote>
<p>For the purposes of this tutorial, I would recommend setting up a <a href="https://docs.microsoft.com/azure/azure-cache-for-redis/cache-overview?WT.mc_id=data-12975-abhishgu#service-tiers">Basic tier instance</a> which is ideal for development/test and non-critical workloads.</p>
</blockquote>
<p>You can also choose to simply use the Redis Docker container as such:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker run --rm -p 6379:6379 redis
</code></pre></div><p>That&rsquo;s it, you&rsquo;re ready to get started!</p>
<h2 id="code-walk-through">Code walk through</h2>
<p>For you to get a better understanding, this section covers a step-by-step walk through of the code. It covers all the functions, each of which covers a specific Redis data structure. It is followed by the <strong>Run the sample application</strong> section.</p>
<h3 id="connect-to-redis">Connect to Redis</h3>
<p>The <code>connect</code> function is used to establish a connection to Redis. It expects host name and the password to be passed in as environment variables <code>REDIS_HOSTNAME</code> and <code>REDIS_PASSWORD</code> respectively. The format for the connection URL is <code>&lt;uri scheme&gt;://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;</code>.</p>
<blockquote>
<p>Azure Cache for Redis only accepts secure connections with <a href="https://docs.microsoft.com/azure/azure-cache-for-redis/cache-remove-tls-10-11?WT.mc_id=data-12975-abhishgu">TLS 1.2 as the minimum required version</a>. The URI scheme would be <code>rediss</code> in case of a TLS connection, otherwise it&rsquo;s <code>redis</code>.</p>
</blockquote>
<p>The call to <a href="https://docs.rs/redis/0.19.0/redis/struct.Client.html#method.open">redis::Client::open</a> performs basic validation while <a href="https://docs.rs/redis/0.19.0/redis/struct.Client.html#method.get_connection">get_connection()</a> actually initiates the connection - the program exits if the connectivity fails due to any reason such as an incorrect password.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">connect</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">redis</span>::<span class="n">Connection</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">//format - host:port
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">redis_host_name</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="w">        </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">&#34;REDIS_HOSTNAME&#34;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;missing environment variable REDIS_HOSTNAME&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">redis_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">&#34;REDIS_PASSWORD&#34;</span><span class="p">).</span><span class="n">unwrap_or_default</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">//if Redis server needs secure connection
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">uri_scheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">&#34;IS_TLS&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;rediss&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;redis&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">redis_conn_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}://:{}@{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">uri_scheme</span><span class="p">,</span><span class="w"> </span><span class="n">redis_password</span><span class="p">,</span><span class="w"> </span><span class="n">redis_host_name</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">redis</span>::<span class="n">Client</span>::<span class="n">open</span><span class="p">(</span><span class="n">redis_conn_url</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;Invalid connection URL&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">get_connection</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to connect to Redis&#34;</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="basic-operations-on-strings-and-integers">Basic operations on Strings and Integers</h3>
<p>This function covers <a href="https://redis.io/commands/set">SET</a>, <a href="https://redis.io/commands/get">GET</a>, and <a href="https://redis.io/commands/incr">INCR</a> commands. The low-level API is used for <code>SET</code> and <code>GET</code>, which sets and retrieves the value for a key named <code>foo</code>. The <code>INCRBY</code> command is executed using a high-level API i.e. <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.incr">incr</a> increments the value of a key (named <code>counter</code>) by <code>2</code> followed by a call to <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.get">get</a> to retrieve it.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">basics</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;SET&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">&#34;foo&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">&#34;bar&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute SET for &#39;foo&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bar</span>: <span class="nb">String</span> <span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">&#34;foo&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute GET for &#39;foo&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;value for &#39;foo&#39; = {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">bar</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">incr</span><span class="p">(</span><span class="s">&#34;counter&#34;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute INCR for &#39;counter&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">val</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#34;counter&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute GET for &#39;counter&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;counter = {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="how-to-use-a-hash-data-structure">How to use a Hash data structure?</h3>
<p>The below code snippet demonstrates the functionality of a Redis <code>HASH</code> data structure. <a href="https://redis.io/commands/hset">HSET</a> is invoked using the low-level API to store information (<code>name</code>, <code>version</code>, <code>repo</code>) about Redis drivers (clients). For example, details for the Rust driver (one being used in this sample code!) is captured in form of a <a href="https://doc.rust-lang.org/std/collections/struct.BTreeMap.html">BTreeMap</a> and then passed on to the low-level API. It is then retrieved using <a href="https://redis.io/commands/hgetall">HGETALL</a>.</p>
<p><code>HSET</code> can also be executed using a high-level API using <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.hset_multiple">hset_multiple</a> that accepts an array of tuples. <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.hget">hget</a> is then executed to fetch the value for a single attribute (the <code>repo</code> in this case).</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">hash</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connect</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">driver</span>: <span class="nc">BTreeMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTreeMap</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;redis-driver&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">driver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;redis-rs&#34;</span><span class="p">));</span><span class="w">
</span><span class="w">    </span><span class="n">driver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;version&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;0.19.0&#34;</span><span class="p">));</span><span class="w">
</span><span class="w">    </span><span class="n">driver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;repo&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;https://github.com/mitsuhiko/redis-rs&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;HSET&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;rust&#34;</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute HSET&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">info</span>: <span class="nc">BTreeMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;HGETALL&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;rust&#34;</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute HGETALL&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;info for rust redis driver: {:?}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">hset_multiple</span><span class="p">(</span><span class="w">
</span><span class="w">            </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;go&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="o">&amp;</span><span class="p">[</span><span class="w">
</span><span class="w">                </span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;go-redis&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">                </span><span class="p">(</span><span class="s">&#34;version&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;8.4.6&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">                </span><span class="p">(</span><span class="s">&#34;repo&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;https://github.com/go-redis/redis&#34;</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="p">],</span><span class="w">
</span><span class="w">        </span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute HSET&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">repo_name</span>: <span class="nb">String</span> <span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">hget</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;go&#34;</span><span class="p">),</span><span class="w"> </span><span class="s">&#34;repo&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;HGET failed&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;go redis driver repo name: {:?}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">repo_name</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="using-redis-lists">Using Redis Lists</h3>
<p>In the function below, you can see how to use a <code>LIST</code> data structure. <a href="https://redis.io/commands/lpush">LPUSH</a> is executed (with the low-level API) to add an entry to the list and the high-level <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.lpop">lpop</a> method is used to retrieve that from the list. Then, the <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.rpush">rpush</a> method is used to add a couple of entries to the list which are then fetched using the low-level <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.lrange">lrange</a> method.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">list</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">list_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;items&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;LPUSH&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">list_name</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">&#34;item-1&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute LPUSH for &#39;items&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">item</span>: <span class="nb">String</span> <span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">lpop</span><span class="p">(</span><span class="n">list_name</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute LPOP for &#39;items&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;first item: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="n">rpush</span><span class="p">(</span><span class="n">list_name</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;item-2&#34;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;RPUSH failed&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="n">rpush</span><span class="p">(</span><span class="n">list_name</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;item-3&#34;</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;RPUSH failed&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span>: <span class="kt">isize</span> <span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">llen</span><span class="p">(</span><span class="n">list_name</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute LLEN for &#39;items&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;no. of items in list = {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">items</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">lrange</span><span class="p">(</span><span class="n">list_name</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute LRANGE for &#39;items&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;listing items in list&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;item: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="store-unique-items-in-a-redis-set">Store unique items in a Redis Set</h3>
<p>Here you can see some of the <code>SET</code> operations. The <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.sadd">sadd</a> (high-level API) method is used to add couple of entries to a <code>SET</code> named <code>users</code>. <a href="https://redis.io/commands/hset">SISMEMBER</a> is then executed (low-level API) to check whether <code>user1</code> exists. Finally, <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.smembers">smembers</a> is used to fetch and iterate over all the set entries in the form of a Vector (<a href="https://doc.rust-lang.org/std/vec/struct.Vec.html">Vec<!-- raw HTML omitted --></a>).</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">set</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">set_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;users&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">sadd</span><span class="p">(</span><span class="n">set_name</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user1&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute SADD for &#39;users&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">sadd</span><span class="p">(</span><span class="n">set_name</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user2&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute SADD for &#39;users&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ismember</span>: <span class="kt">bool</span> <span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;SISMEMBER&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">set_name</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">&#34;user1&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute SISMEMBER for &#39;users&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;does user1 exist in the set? {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ismember</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">users</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="n">smembers</span><span class="p">(</span><span class="n">set_name</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute SMEMBERS&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;listing users in set&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;user: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="take-advantage-of-redis-sorted-sets">Take advantage of Redis Sorted Sets</h3>
<p><code>sorted_set</code> function below demonstrates the Sorted Set data structure. <a href="https://redis.io/commands/zadd">ZADD</a> is invoked (with the low-level API) to add a random integer score for a player (<code>player-1</code>). Next, the <a href="https://docs.rs/redis/0.19.0/redis/trait.Commands.html#method.zadd">zadd</a> method (high-level API) is used to add more players (<code>player-2</code> to <code>player-5</code>) and their respective (randomly generated) scores. The number of entries in the sorted set is figured out using <a href="https://redis.io/commands/zcard">ZCARD</a> and that&rsquo;s used as the limit to the <a href="https://redis.io/commands/zrange">ZRANGE</a> command (invoked with the low-level API) to list out the players with their scores in ascending order.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">sorted_set</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sorted_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;leaderboard&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redis</span>::<span class="n">cmd</span><span class="p">(</span><span class="s">&#34;ZADD&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">sorted_set</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">rand</span>::<span class="n">thread_rng</span><span class="p">().</span><span class="n">gen_range</span><span class="p">(</span><span class="mi">1</span><span class="p">..</span><span class="mi">10</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">&#34;player-1&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute ZADD for &#39;leaderboard&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="p">..</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">zadd</span><span class="p">(</span><span class="w">
</span><span class="w">                </span><span class="n">sorted_set</span><span class="p">,</span><span class="w">
</span><span class="w">                </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;player-&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w">
</span><span class="w">                </span><span class="n">rand</span>::<span class="n">thread_rng</span><span class="p">().</span><span class="n">gen_range</span><span class="p">(</span><span class="mi">1</span><span class="p">..</span><span class="mi">10</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute ZADD for &#39;leaderboard&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">count</span>: <span class="kt">isize</span> <span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">zcard</span><span class="p">(</span><span class="n">sorted_set</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;failed to execute ZCARD for &#39;leaderboard&#39;&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">leaderboard</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="kt">isize</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">zrange_withscores</span><span class="p">(</span><span class="n">sorted_set</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;ZRANGE failed&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;listing players and scores in ascending order&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{} = {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Now that you&rsquo;ve gone through the code, it&rsquo;s time to run the application and check the output.</p>
<h2 id="run-the-sample-application">Run the sample application</h2>
<p>Start by cloning the GitHub repo:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">git clone https://github.com/abhirockzz/rust-redis-101.git
<span class="nb">cd</span> rust-redis-101
</code></pre></div><p>If you&rsquo;re using a local Redis server (e.g. with Docker) over an insecure connection without any password, simply use:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">export</span> <span class="nv">REDIS_HOSTNAME</span><span class="o">=</span>localhost:6379
</code></pre></div><p>If you&rsquo;re using Azure Cache for Redis, <a href="https://docs.microsoft.com/azure/azure-cache-for-redis/cache-python-get-started?WT.mc_id=data-12975-abhishgu#retrieve-host-name-ports-and-access-keys-from-the-azure-portal">fetch the Host name and Access Keys</a> from the <a href="https://portal.azure.com/">Azure portal</a>. Set the respective environment variables:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">export</span> <span class="nv">REDIS_HOSTNAME</span><span class="o">=</span>&lt;Host name&gt;:&lt;port&gt; <span class="o">(</span>e.g. &lt;name of cache&gt;.redis.cache.windows.net:6380<span class="o">)</span>
<span class="nb">export</span> <span class="nv">REDIS_PASSWORD</span><span class="o">=</span>&lt;Primary Access Key&gt;
<span class="nb">export</span> <span class="nv">IS_TLS</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div><p>To run the application:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cargo run
</code></pre></div><p>You will see an output as such:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">******* Running SET, GET, INCR commands *******
value <span class="k">for</span> <span class="s1">&#39;foo&#39;</span> <span class="o">=</span> bar
<span class="nv">counter</span> <span class="o">=</span> <span class="m">29</span>
******* Running HASH commands *******
info <span class="k">for</span> rust redis driver: <span class="o">{</span><span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;redis-rs&#34;</span>, <span class="s2">&#34;repo&#34;</span>: <span class="s2">&#34;https://github.com/mitsuhiko/redis-rs&#34;</span>, <span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;0.19.0&#34;</span><span class="o">}</span>
go redis driver repo name: <span class="s2">&#34;https://github.com/go-redis/redis&#34;</span>
******* Running LIST commands *******
first item: item-1
no. of items in <span class="nv">list</span> <span class="o">=</span> <span class="m">2</span>
listing items in list
item: item-2
item: item-3
******* Running SET commands *******
does user1 exist in the set? <span class="nb">true</span>
listing users in <span class="nb">set</span>
user: user2
user: user1
user: user3
******* Running SORTED SET commands *******
listing players and scores
player-4 <span class="o">=</span> <span class="m">3</span>
player-3 <span class="o">=</span> <span class="m">7</span>
player-1 <span class="o">=</span> <span class="m">8</span>
player-2 <span class="o">=</span> <span class="m">8</span>
player-5 <span class="o">=</span> <span class="m">8</span>
</code></pre></div><blockquote>
<p>Important: If you were using Azure Cache for Redis, please ensure that you delete the Redis instance.</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial, you learned how to use the Rust driver for Redis to connect and execute operations in Azure Cache for Redis. If you found this helpful, you may want to explore these additional resources:</p>
<ul>
<li><a href="https://redis.io/topics/data-types-intro">An introduction to Redis data types and abstractions</a></li>
<li>Read <a href="https://doc.rust-lang.org/book/index.html">The Rust Book</a></li>
<li><a href="https://github.com/rust-lang/rustlings">Try small exercises to get you used to reading and writing Rust code</a></li>
<li><a href="https://docs.microsoft.com/azure/architecture/best-practices/caching?toc=%2fazure%2fredis-cache%2ftoc.json&amp;WT.mc_id=data-12975-abhishgu">Considerations for designing and using a cache</a></li>
<li><a href="https://docs.microsoft.com/azure/azure-cache-for-redis/cache-best-practices?WT.mc_id=data-12975-abhishgu">Best practices for Azure Cache for Redis</a></li>
<li><a href="https://docs.microsoft.com/azure/azure-cache-for-redis/cache-high-availability?WT.mc_id=data-12975-abhishgu">High availability for Azure Cache for Redis</a></li>
</ul>


        
          <div class="blog-tags">
            
              <a href="https://abhirockzz.github.io//tags/rust/">Rust</a>&nbsp;
            
              <a href="https://abhirockzz.github.io//tags/redis/">Redis</a>&nbsp;
            
              <a href="https://abhirockzz.github.io//tags/azure/">Azure</a>&nbsp;
            
              <a href="https://abhirockzz.github.io//tags/nosql/">NoSQL</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://abhirockzz.github.io/posts/postgres-kafka-cassandra/" data-toggle="tooltip" data-placement="top" title="Learn how to setup data pipeline from PostgreSQL to Cassandra using Kafka Connect">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://abhirockzz.github.io/posts/redis-grafana/" data-toggle="tooltip" data-placement="top" title="An easy to use monitoring solution for Redis">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/abhirockzz" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/abhi_tweeter" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/abhirockzz" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://abhirockzz.github.io">Abhishek Gupta</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2021
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://abhirockzz.github.io/">Foo Bar Baz</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.80.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://abhirockzz.github.io/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://abhirockzz.github.io/js/load-photoswipe.js"></script>









    
  </body>
</html>

